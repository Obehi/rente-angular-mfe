<mat-horizontal-stepper class="stepper" [linear]="false" #stepper>
    <mat-step [stepControl]="userFormGroup" [editable]="true">
        <h3>step 1</h3>

        <form *ngIf="showForms" [formGroup]="userFormGroup" novalidate (ngSubmit)="goToLoansForm()">

            <div class=" field">
                <rente-input [placeholder]="'E-post'" formControlName="email" [errorStateMatcher]="
                    isErrorState(userFormGroup.controls['email'])
                  " [modelOptions]="{ updateOn: 'blur' }">
                </rente-input>

                <div *ngIf="userFormGroup.controls['email'].touched">
                    <p class="error small" *ngIf="userFormGroup.controls['email'].hasError('required')">
                        Kan ikke være tom
                    </p>
                    <p class="error small" *ngIf="userFormGroup.controls['email'].hasError('pattern')">
                        Ugyldig e-post
                    </p>
                </div>
            </div>



            <div class="address-grid">
                <div class="field">
                    <rente-input [placeholder]="'Adresse'" formControlName="address" [errorStateMatcher]="
                        isErrorState(userFormGroup.controls['address'])
                      " [modelOptions]="{ updateOn: 'blur' }">
                    </rente-input>

                    <div *ngIf="userFormGroup.controls['address'].touched">
                        <p i18n=“empty|info-confirmation@@info.confirmation.empty” class="error small"
                            *ngIf="userFormGroup.controls['address'].hasError('required')">
                            Kan ikke være tom
                        </p>
                    </div>
                </div>

                <div class="field">
                    <rente-input [placeholder]="'Postnummer'" formControlName="zip" [maxLength]="4" [errorStateMatcher]="
                        isErrorState(userFormGroup.controls['zip'])
                      " [modelOptions]="{ updateOn: 'blur' }">
                    </rente-input>

                    <div *ngIf="userFormGroup.controls['zip'].touched">
                        <p i18n=“empty|info-confirmation@@info.confirmation.empty” class="error small"
                            *ngIf="userFormGroup.controls['zip'].hasError('required')">
                            Kan ikke være tom
                        </p>
                    </div>
                </div>

                <div class="field">
                    <rente-input [placeholder]="'Størrelse på boligen din'" formControlName="apartmentSize"
                        matSuffix="kvm" [errorStateMatcher]="
                isErrorState(
                  userFormGroup.controls['apartmentSize']
                )
              " [type]="'tel'" [maskType]="mask.squareMeter">
                    </rente-input>

                    <div *ngIf="userFormGroup.controls['apartmentSize'].touched">
                        <p i18n=“empty2|info-confirmation@@info.confirmation.empty2” class="error small" *ngIf="
                  userFormGroup.controls['apartmentSize'].hasError('required')">Kan ikke være tom
                        </p>
                    </div>
                </div>
            </div>

            <div class="field">
                <p i18n=“organization|info-confirmation@@info.confirmation.organization” class="small">
                    Bankene gir ofte bedre betingelser om du er medlem i en organisasjon
                </p>
                <mat-form-field>
                    <input type="text" placeholder="+ Legg til medlemskap (valgfritt)" matInput
                        [formControl]="membershipCtrl" formControlName="membership" #membershipInput
                        [matAutocomplete]="auto" />
                    <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
                        <mat-option *ngFor="let membership of filteredMemberships | async" [value]="membership">
                            {{ membership.label }}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
                <p i18n=“my-memberships|info-confirmation@@info.confirmation.myMemberships” class="small"
                    *ngIf="memberships.length">
                    Mine medlemskap
                </p>
                <p class="memberlist" *ngFor="let membership of memberships; let i = index">
                    {{ membership.label }}
                    <mat-icon class="clickable" (click)="remove(membership, i)" *ngIf="removable">delete_forever
                    </mat-icon>
                </p>
            </div>


            <div class="field">
                <div class="withinfo">
                    <div>

                        <rente-input [placeholder]="'Din brutto årsinntekt'" formControlName="income" matSuffix="kr"
                            [errorStateMatcher]="
            isErrorState(userFormGroup.controls['income'])
          " [type]="'tel'" [maskType]="mask.currency">
                        </rente-input>
                        <div *ngIf="userFormGroup.controls['income'].touched">
                            <p i18n=“empty3|info-confirmation@@info.confirmation.empty3” class="error small"
                                *ngIf="userFormGroup.controls['income'].hasError('required')">
                                Kan ikke være tom
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <button mat-button matStepperNext>Next</button>

                <rente-button matStepperNext color="primary" [isLoading]="isLoading"
                    [disabled]="userFormGroup.invalid || isLoading">
                    Neste
                </rente-button>
            </div>

        </form>

    </mat-step>
    <mat-step [editable]="true">
        <h3>step 2</h3>
        <form *ngIf="showForms" [formGroup]="loanFormGroup" novalidate (ngSubmit)="doneClicked()">


            <div class=" field">
                <rente-input [placeholder]="'Estimert totalbetaling'" formControlName="outstandingDebt"
                    [errorStateMatcher]="
                    isErrorState(loanFormGroup.controls['outstandingDebt'])
                  " [modelOptions]="{ updateOn: 'blur' }">
                </rente-input>

                <div *ngIf="loanFormGroup.controls['outstandingDebt'].touched">
                    <p class="error small" *ngIf="loanFormGroup.controls['outstandingDebt'].hasError('required')">
                        Kan ikke være tom
                    </p>
                </div>
            </div>

            <div class="field">
                <rente-input [placeholder]="'Max løpetid'" formControlName="remainingYears" [errorStateMatcher]="
                    isErrorState(loanFormGroup.controls['remainingYears'])
                  " [modelOptions]="{ updateOn: 'blur' }">
                </rente-input>

                <div *ngIf="loanFormGroup.controls['remainingYears'].touched">
                    <p class="error small" *ngIf="loanFormGroup.controls['remainingYears'].hasError('required')">
                        Kan ikke være tom
                    </p>
                </div>
            </div>


            <div class="field">
                <rente-select [options]="selectOptions" [name]="'test'" placeholder="'Lånetype"
                    (selected)="offerSelected($event)">
                </rente-select>
            </div>

            <rente-button click matStepperNext color="primary" [isLoading]="isLoading"
                [disabled]="loanFormGroup.invalid || isLoading">
                Ferdig
            </rente-button>

        </form>
    </mat-step>


</mat-horizontal-stepper>

<div class=" loading" *ngIf="isLoading">
    <mat-spinner [diameter]="48" [strokeWidth]="4"></mat-spinner>
</div>