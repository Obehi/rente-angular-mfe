<div class="loading" *ngIf="isLoading && !errorMessage">
  <mat-spinner [diameter]="48" [strokeWidth]="4"></mat-spinner>
</div>

<div
  class="offers"
  *ngIf="
    offersInfo?.ltvType === offersLtvType.LTV_OK ||
    offersInfo?.ltvType === offersLtvType.LTV_TOO_HIGH_85"
>

<div class ="desktop">
  <a
      *ngIf="offersInfo?.ltvType === offersLtvType.LTV_TOO_HIGH_85"
      class="obs clickable"  
      (click)="openLtvTooHightDialog()"
    >
    
      <p>
        <b>OBS:</b> Vi har beregnet belåningsgraden din til over 85%. 
        Vennligst kontroller boligverdien i boligfanen. Du kan også lese 
        mer om dette ved å  <a >klikke her</a>.
        
      </p>
  </a>

  <div
      *ngIf="
        offersInfo?.incompleteInfoLoanPresent === true
      "
      class="obs"
    >
      <p>
        <b>OBS:</b> Vi får kun hentet din nominelle rente og lånebeløp. For
        utregninger har vi tatt utgangspunkt i en gjenværende løpetid på 20 år,
        månedlige betalinger og 50,- i termingebyr. Faktisk løpetid og
        termingebyrer vil endre forventede besparelser.
      </p>
    </div>
</div>
  <!-- Mobile Tips -->
  <div class="mobile">
    <div
      class="tipsAccordion"
      (click)="isShowTips = !isShowTips"
      *ngIf="tips.length > 0"
    >
      <p>
        <mat-icon *ngIf="!isShowTips">expand_more</mat-icon>
        <mat-icon *ngIf="isShowTips">expand_less</mat-icon>
        <span class="nr">{{ tips.length }}</span> tips
      </p>
    </div>
    <div
      class="tips"
      style="border-bottom: none;"
      *ngIf="tips.length > 0 && !isShowTips"
    ></div>
    <div class="tips" *ngIf="isShowTips && tips.length > 0">
      <div *ngFor="let tip of tips; let i = index">
        <div
          *ngIf="!tip.external"
          routerLink="{{ tip.buttonLink }}"
          class="tip"
        >
          <p>
            {{ tip.text }}
          </p>

          <mat-icon *ngIf="tip.buttonLink !== './'">chevron_right</mat-icon>
        </div>

        <a
          *ngIf="tip.external"
          href="{{ tip.buttonLink }}"
          target="_blank"
          class="tip"
        >
          <p>
            {{ tip.text }}
          </p>

          <mat-icon>chevron_right</mat-icon>
        </a>
      </div>
    </div>
    <a
      *ngIf="offersInfo?.ltvType === offersLtvType.LTV_TOO_HIGH_85"
      class="obs clickable"  
      (click)="openLtvTooHightDialog()"
    >
    
      <p>
        <b>OBS:</b> Vi har beregnet belåningsgraden din til over 85%. 
        Vennligst kontroller boligverdien i boligfanen. Du kan også lese 
        mer om dette ved å  <a (click)="openLtvTooHightDialog()">klikke her</a>.
        
      </p>
    </a>
    <div
      *ngIf="
        offersInfo?.incompleteInfoLoanPresent === true
      "
      class="obs"
    >
      <p>
        <b>OBS:</b> Vi får kun hentet din nominelle rente og lånebeløp. For
        utregninger har vi tatt utgangspunkt i en gjenværende løpetid på 20 år,
        månedlige betalinger og 50,- i termingebyr. Faktisk løpetid og
        termingebyrer vil endre forventede besparelser.
      </p>
    </div>
  </div>
  <!-- Mobile Tips -->

  <div class="barometer">
    
    <div class="rente-status" [ngSwitch]="offersInfo.offerSavingsType">
      <p *ngSwitchCase="offerSavingsType.NO_SAVINGS">
        Renten din er <b>svært god</b>
      </p>
      <p
        *ngSwitchCase="
          offerSavingsType.SAVINGS_FIRST_YEAR_BETWEEN_0_AND_2000
        "
      >
        Renten din er <b>god</b>, men ikke best
      </p>
      <p
        *ngSwitchCase="
          offerSavingsType.SAVINGS_FIRST_YEAR_BETWEEN_2000_AND_6000
        "
      > 
        Renten din er <b>OK</b>, men du kan få bedre
      </p>
      <p
        *ngSwitchCase="
          offerSavingsType.SAVINGS_FIRST_YEAR_BETWEEN_6000_AND_10000
        "
      >
        Renten din er <b>dårlig</b> og du kan spare en del
      </p>
      <p *ngSwitchCase="offerSavingsType.SAVINGS_FIRST_YEAR_GREATER_10000">
        Renten din er <b>svært  dårlig</b> 
      </p>
      <div *ngSwitchDefault>-</div>
    </div>

    <div class="rente-bar-container center-horizontal">
      <div class="bar-ticks">
        <p>Dårlig rente</p>
        <p>Bra rente</p>
      </div>
      <div class="bar-wrap" [ngClass]="[rateBarPercentage.class]" > 
        <span class="bar-fill" [ngStyle]="{'width': rateBarPercentageInverted + '%'}"></span> 
        <!-- <span class="bar-fill" [ngStyle]="{'width': 0 + '%'}"></span> -->
      </div>

      <!--
      <div class="arrow-box center-align" [ngStyle]="{'left': barBoxPosition}">
        <p>Din rente</p>
      </div>
      --> 
    </div>

    <div class="save-info">
      <p>Du kan spare</p>
        <h2 *ngIf="offersInfo.bestOfferTotalSaving > 0; else noBestOffer">
          {{ offersInfo.bestOfferTotalSaving | abs | number }},-
        </h2>
        <ng-template #noBestOffer>
          <h2>0,-</h2>
        </ng-template>
      <p>over lånets løpetid</p>
    </div>
  </div>

  <div class="split-sections">
    <div class="split-section">
      


     

        <!-- Mobile boxes -->
        <div class="rente-boxes mobile">
          <div class="double">
            <div class="box">
              <p>Din effektive rente</p>
              <h2>{{ offersInfo.totalEffectiveRate | number: "1.2-2" }}%</h2>
            </div>
            <a class="box positive clickable" (click)="goToBestOffer()">
              <p>
                Beste tilbud <img src="../../../../assets/icons/go_to.svg" />
              </p>
              <h2>
                {{ offersInfo.bestOfferEffectiveRate | number: "1.2-2" }}%
              </h2>
              <!-- <h2>{{ offersInfo.customerName | null }}</h2> -->
            </a>
          </div>
          <div class="double">
            <a class="box clickable" (click)="goToProperty()">
              <p>
                Boligverdi <img src="../../../../assets/icons/go_to.svg" />
              </p>
              <h2>
                {{ offersInfo.propertyValue / 1000000 | number: "1.1-3" }}
                mill.
              </h2>
              <p class="small">
                  Fellesgjeld
                {{
                  (offersInfo.commonDebt / 1000000 | number: "1.1-2")
                }}
                mill.
              </p>
            
              <p class="small">
                Estimat levert av
                <a href="https://virdi.no/" target="_blank">virdi.no</a>
              </p>
            </a>
            <a class="box clickable" (click)="goToLoans()">
              <p>
                Gjenværende lån <img src="../../../../assets/icons/go_to.svg" />
              </p>
              <h2>
                {{
                  offersInfo.totalOutstandingDebt / 1000000 | number: "1.1-3"
                }}
                mill.
              </h2>
              <p class="small">
                Belåningsgrad
                {{
                  (offersInfo.ltv) *
                    100 | number: "1.1-1"
                }}%
              </p>
            </a>
          </div>
        </div>
        <!-- Mobile boxes -->
     
        <div class="mobile">
          <div class="top-buttons full-width">
            <div class="item">
            
            
              <p>Vi har funnet de 5 beste tilbudene for deg</p>
              <rente-button class="min-width vertical-20"
                [disabled]="changeBankLoading ||
                offersInfo.offerSavingsType === offerSavingsType.NO_SAVING"
                [isLoading]="changeBankLoading"
                color="primary"
                type="raised"
                (click)="goToBestOffer()"
                >Se beste tilbud</rente-button
              >
            </div> 
            
            <div class="item">
        
              <p>Vi hjelper deg å be banken din om lavere rente</p>
              <div class="max-width vertical-20">
                <rente-button
                  class="min-width"
                  [disabled]="
                  changeBankLoading ||
                  offersInfo.offerSavingsType === offerSavingsType.NO_SAVINGS"
                  [isLoading]="changeBankLoading"
                  color="primary"
                  type="raised"
                  (click)="openChangeBankDialog(offersInfo.offers[0])"
                  >Be banken matche tilbud</rente-button
                > 
              </div> 
            </div> 
          </div>
        </div>

      <div class="desktop">
        
        

     <!-- Desktop boxes -->
    <div class="rente-boxes desktop">
      <div class="double">
        <div class="box">
          <p>Din effektive rente</p>
          <h2>{{ offersInfo.totalEffectiveRate | number: "1.2-2" }}%</h2>
        </div>
        <a class="box positive clickable" (click)="goToBestOffer()">
          <p>Beste tilbud <img src="../../../../assets/icons/go_to.svg" /></p>
          <h2>{{ offersInfo.bestOfferEffectiveRate | number: "1.2-2" }}%</h2>
        
        </a>
      </div>
      <div class="double">
          <a class="box clickable" (click)="goToProperty()">
            <p>
              Boligverdi <img src="../../../../assets/icons/go_to.svg" />
            </p>
            <h2>
              {{ offersInfo.propertyValue / 1000000 | number: "1.1-3" }}
              mill.
            </h2>
            <p class="small">
                Fellesgjeld
              {{
                (offersInfo.commonDebt / 1000000 | number: "1.1-2")
              }} mill.
            </p>
          
            <p class="small">
              Estimat levert av
              <a href="https://virdi.no/" target="_blank">virdi.no</a>
            </p>
          </a>
          <a class="box clickable" (click)="goToLoans()">
            <p>
              Gjenværende lån <img src="../../../../assets/icons/go_to.svg" />
            </p>
            <h2>
              {{
                offersInfo.totalOutstandingDebt / 1000000 | number: "1.1-3"
              }}
              mill.
            </h2>
            <p class="small">
              Belåningsgrad
              {{
                (offersInfo.ltv) *
                  100 | number: "1.1-1"
              }}%
            </p>
          </a>
      </div>

      <div
          class="tipsAccordion clickable"
          (click)="isShowTips = !isShowTips"
          *ngIf="tips.length > 0"
        >
        <p>
          <mat-icon *ngIf="!isShowTips">expand_more</mat-icon>
          <mat-icon *ngIf="isShowTips">expand_less</mat-icon>
          <span class="nr">{{ tips.length }}</span> tips
        </p>
      </div>
        <div
          class="tips"
          style="border-bottom: none;"
          *ngIf="tips.length > 0 && !isShowTips"
        ></div>
        <div class="tips" *ngIf="isShowTips && tips.length > 0">
          <div
            *ngFor="let tip of tips; let i = index"
            [ngClass]="tip.buttonLink === './' ? '' : 'clickable'"
          >
            <div
              *ngIf="!tip.external"
              routerLink="{{ tip.buttonLink }}"
              class="tip"
            >
              <p>
                {{ tip.text }}
              </p>

              <mat-icon *ngIf="tip.buttonLink !== './'">chevron_right</mat-icon>
            </div>

            <a
              *ngIf="tip.external"
              href="{{ tip.buttonLink }}"
              target="_blank"
              class="tip"
            >
              <p>
                {{ tip.text }}
              </p>

              <mat-icon>chevron_right</mat-icon>
            </a>
          </div>
        </div>
      </div>
    </div>
    <!-- Desktop boxes -->
      
    </div>
    <div class="split-section">

      <div class="compared">
        <rente-offers-statistics [offersInfo]="offersInfo">
        </rente-offers-statistics>
      </div> 

     

    </div>
  </div>

  <div class="desktop">
    <div class="top-buttons full-width">
      <div class="item">
      
      
        <p>Vi har funnet de 5 beste tilbudene for deg</p>
        <rente-button class="min-width vertical-20"
          [disabled]="changeBankLoading ||
          offersInfo.offerSavingsType === offerSavingsType.NO_SAVING"
          [isLoading]="changeBankLoading"
          color="primary"
          type="raised"
          (click)="goToBestOffer()"
          >Se beste tilbud</rente-button
        >
      </div> 
      
      <div class="item">
  
        <p>Vi hjelper deg å be banken din om lavere rente</p>
        <div class="max-width vertical-20">
          <rente-button
            class="min-width"
            [disabled]="
            changeBankLoading ||
            offersInfo.offerSavingsType === offerSavingsType.NO_SAVINGS"
            [isLoading]="changeBankLoading"
            color="primary"
            type="raised"
            (click)="openChangeBankDialog(offersInfo.offers[0])"
            >Be banken matche tilbud</rente-button
          > 
        </div> 
      </div> 
    </div>
  </div>

  <div class="the-offers">
    <h3 style="margin-bottom: 20px;">
      {{ getVariation()}} beste tilbud
    </h3>

    
    <div *ngIf="  getVariation() === 1 || getVariation() === 2" class="sticky-table-header">
      <p>BANK</p>
      <p>Din effektive rente: <span>{{ offersInfo.totalEffectiveRate | number: "1.2-2" }}%</span></p>
    </div>
    
    <div class="offers-grid">    
      <ng-container *ngIf="offersInfo">
        <div
          *ngFor="let offer of offersInfo.offers; let i = index"
          class="the-offer"
        >
       
        <ng-container *ngIf="getVariation() === undefined || getVariation() === null">
          <rente-offer-card-big [offer]="offer" [offersInfo]="offersInfo" [index]=i></rente-offer-card-big>
        </ng-container>

        <ng-container *ngIf="getVariation() === 0">
          <rente-offer-card-big [offer]="offer" [offersInfo]="offersInfo" [index]=i></rente-offer-card-big>
        </ng-container>

        <ng-container *ngIf="getVariation() === 1 || getVariation() === 2 || getVariation() === 3 ">
          <rente-offer-card [offer]="offer" [offersInfo]="offersInfo" [index]=i></rente-offer-card>
        </ng-container>   

        
        


          <!--
          <div class="the-offer-header">
            <div
              class="logo"
              [ngStyle]="{
                'background-image': 'url(' + banksMap[offer.bankInfo.bank].img + ')'
              }"
            >
              <div class="nr">
                <p>{{ i + 1 }}</p>
              </div>
            </div>
            <div class="offer-product">

              <a class="clickable" target="_blank"
              (click)="openBankUrl(offer)"
                >{{ offer.bankInfo.name }}<mat-icon>open_in_new</mat-icon></a
              >
              <h3 (click)="openOfferDialog(offer)" class="clickable">
                {{ offer.productName }}<mat-icon>help</mat-icon>
              </h3>
            </div>
          </div>
          <div class="the-offer-body">
            <div class="small-header"><p>Rentebesparelse</p></div>
            <div class="split">
              <div class="offer-inner save">
                <h2 *ngIf="offer.totalSavings > 0; else noTotalSavings">
                  {{ offer.totalSavings | abs | number }},-
                </h2>
                <ng-template #noTotalSavings>
                  <h2>0,-</h2>
                </ng-template>
                <p>over lånets løpetid</p>
              </div>
              <div class="offer-inner save">
                <h2 *ngIf="offer.savingsFirstYear > 0; else noTotalSavings">
                  {{ offer.savingsFirstYear | abs | number }},-
                </h2>
                <ng-template #noSavingsFirstYear>
                  <h2>0,-</h2>
                </ng-template>
                <p>første år</p>
              </div>
            </div>
            <div class="split">
              <div class="offer-info">
                <div class="small-header">
                  <p>Effektiv rente</p>
                </div>
                <div class="offer-inner">
                  <h2>{{ offer.effectiveRate | number: "1.2-2" }}%</h2>
                </div>
              </div>
              <div class="offer-info">
                <div class="small-header">
                  <p>Krever tilleggsprodukt</p>
                </div>
                <div class="offer-inner">
                  <h2 (click)="openOfferDialog(offer)" class="clickable">
                    {{ offer.requiredProductPackage == null ? "Nei" : "Ja" }}
                    <mat-icon>help</mat-icon>
                  </h2>
                </div>
              </div>
            </div>

            <div class="split">
              <div class="offer-info">
                <div class="small-header">
                  <p>Kundetilfredshet</p>
                </div>
                <div class="offer-inner center-align">
                  <img class="offer-score" src="../../../../assets/icons/score-{{offer.bankInfo.score }}.svg"/>
              
                </div>
              </div>
              <div class="offer-info">
                <div class="small-header">
                  <p>Hvor lang tid tar det å bytte</p>
                </div>
                <div class="offer-inner time">
                  <div class="center">
                    <img src="../../../../assets/icons/clock.svg"/> 
                    <h3 >
                      {{offer.bankInfo.applicationTime  === null ? 'Ukjent' : offer.bankInfo.applicationTime + " min"}}
                    </h3>
                </div>
                </div>
              </div>
            </div>

            <div class="small-header">
              <p class="insignificant"><span>Tilbud:
              </span> Eff.rente {{offer.effectiveRate | number: "1.2-2"}}%, 
                Lånebeløp {{offer.outstandingDebt | number: "1.0" }}, 
                {{offer.loanPeriodYears | number: "1.1-1" }} år, 
                Kostnad: {{offer.cost | number: "1.0" }}, 
                Totalt: {{offer.totalCost | number: "1.0" }}
              </p>
            </div>
          </div>

          <div class="double buttons">
          
            <div class="full-width">
             
              <rente-button
                [disabled]="
                  changeBankLoading ||
                  offersInfo.offerSavingsType === offerSavingsType.NO_SAVINGS ||
                  offer.bankInfo.partner == false"
                [isLoading]="changeBankLoading"
                color="primary"
                type="raised"
                (click)="openBankUrlByButton(offer)"
                >Se mer på {{getbankNameOrDefault(offer)}}s <br/> hjemmeside</rente-button
              >

              <p class="small" *ngIf=" offer.bankInfo.partner === false && isMobile === false"> (Ingen avtale med banken enda)</p>

            </div>
          
           


            <div class="full-width">
              
              <rente-button
              [disabled]="
                  changeBankLoading ||
                  offersInfo.offerSavingsType === offerSavingsType.NO_SAVINGS ||
                    offer.bankInfo.partner == false"
                [isLoading]="changeBankLoading"
                color="primary"
                type="raised"
                (click)="openNewOfferDialog(offersInfo.offers[i])"
                >Få tilbud fra {{getbankNameOrDefault(offer)}}!</rente-button
              >     
              <p class="small" *ngIf=" offer.bankInfo.partner === false"> (Ingen avtale med banken enda)</p>
              
             
            </div>
          </div>
        -->
        </div>
      </ng-container>
    </div>
  </div>

</div>
<div class="problems" style="max-width: 780px;">
  
  <div
    class="title"
    *ngIf="
      offersInfo?.ltvType === offersLtvType.LTV_CREDIT_LINE_TOO_HIGH_60
    "
  >
    <h3>
      Rammelån/boligkreditt er kun tilgjengelig for lavere belåningsgrad enn
      60%.
    </h3>
    <p>
      Din belåningsgrad er høyere enn dette, vennligst endre din belåningsgrad
      i<a [routerLink]="['/dashboard/bolig']"> boligfanen</a>
    </p>
  </div>
  <div class="title" *ngIf="!offersInfo && !isLoading && !errorMessage">
    <h3>Ingen bedre tilbud enda...</h3>
  </div>

  <div class="title" *ngIf="errorMessage">
    <h3>{{ errorMessage }}</h3>
  </div>
</div>

<div *ngIf="effRateLoweredDialogVisible">
  <rente-dialog
    [title]="'Du har lavere rente enn forrige gang!'"
    [message]="'Brukte du prutefunksjonen vår for å få bedre rente?'"
    (action)="onDialogAction($event)"
  >
  </rente-dialog>
</div>
